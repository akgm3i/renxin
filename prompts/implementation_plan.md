# RENXIN 実装計画兼タスク管理

このドキュメントは実装計画であり、タスク管理も兼ねている。作業を進める際は該当タスクの進捗を更新していく。
記載のテストリストはTDD実践する上でのふるまいリストを表している。
タスク完了後、チェックを入れること。

## 全体進捗

- [ ] Phase 1: UIプロトタイピングと基本的な画面遷移
- [ ] Phase 2: Coreロジック（ゲームロジック、データ永続化）の実装とUIとの連携
- [ ] Phase 3: カメラ連携とリアルタイム観戦機能
- [ ] Phase 4: データ分析・統計機能とエラーハンドリング・ログ
- [ ] Phase 5: 将来的なサーバー分離フェーズへの準備

---

### Phase 1: UIプロトタイピングと基本的な画面遷移 (Frontend先行)

- [ ] **環境構築と初期セットアップ**
    - 内容: Tauriプロジェクトの初期化、Deno/TypeScript/React環境のセットアップ、Rust開発環境の確認。
    - 参照: [`docs/spec.md`](docs/spec.md:170), [`docs/components.md`](docs/components.md:12)
    - テストリスト:
        - [ ] Tauriアプリケーションが正常に起動すること
        - [ ] Frontend (React) と Backend (Rust) 間でIPC通信の疎通確認ができること (ping/pongのような簡単な関数呼び出し)
    - 進捗: 未着手。

- [ ] **デザインシステムの基本実装**
    - 内容: `docs/about.md` のカラーパレットと `docs/uiux.md` のデザインシステム検討に基づき、共通コンポーネント（ボタン、ヘッダーなど）のスタイルを定義する。
    - 参照: [`docs/about.md`](docs/about.md:9), [`docs/uiux.md`](docs/uiux.md:170)
    - テストリスト:
        - [ ] 定義されたカラーパレットが適用されていること
        - [ ] 共通ボタンコンポーネントが正しく表示され、クリックイベントが発火すること
    - 進捗: 未着手。

- [ ] **画面遷移フローのUI実装（ダミーデータ）**
    - 内容: `docs/uiux.md` の画面遷移フローに基づき、ホーム画面、プレイヤー管理画面、ゲーム画面、ラウンド終了・動画再生画面、統計データ画面のUIをダミーデータで実装する。各画面間の遷移を実装し、UI/UXの確認を行う。
    - 参照: [`docs/uiux.md`](docs/uiux.md:5)
    - テストリスト:
        - [ ] アプリケーション起動時に初回起動/2回目以降の画面遷移が正しいこと
        - [ ] ホーム画面から各画面へ正しく遷移できること
        - [ ] ゲーム画面からラウンド終了・動画再生画面へ遷移できること
        - [ ] ラウンド終了・動画再生画面からゲーム画面/ホーム画面へ遷移できること
        - [ ] プレイヤー管理画面からホーム画面へ遷移できること
    - 進捗: 未着手。

- [ ] **プレイヤー管理UIの実装（Frontend）**
    - 内容: プレイヤーの新規登録フォーム、プレイヤー一覧表示、プレイヤー選択UIを実装する。データはFrontend内で一時的に管理する。
    - 参照: [`docs/uiux.md`](docs/uiux.md:120)
    - テストリスト:
        - [ ] 新規プレイヤー登録フォームで入力・登録ができること
        - [ ] 登録したプレイヤーが一覧に表示されること
        - [ ] プレイヤーを選択すると、そのプレイヤーが選択状態になること
        - [ ] プレイヤー名の入力バリデーション（例: 空白でないこと、最大長）
    - 進捗: 未着手。

- [ ] **ゲーム画面UIの実装（Frontend）**
    - 内容: ダーツボードUI、スコア表示エリア、操作エリア（UNDO、ラウンド終了）を実装する。着弾点入力はUIのみで完結し、スコア計算はFrontendで簡易的に行う。
    - 参照: [`docs/uiux.md`](docs/uiux.md:71)
    - テストリスト:
        - [ ] ダーツボードUIが正しく表示され、タッチ入力ができること
        - [ ] 入力に応じてスコア表示が更新されること（簡易計算）
        - [ ] UNDOボタンで直前の入力が取り消されること
        - [ ] ラウンド終了ボタンが機能すること
    - 進捗: 未着手。

### Phase 2: Coreロジック（ゲームロジック、データ永続化）の実装とUIとの連携

- [ ] **データベーススキーマ定義と初期化（Backend）**
    - 内容: `docs/data.md` に基づき、SQLiteデータベースのスキーマをRustで定義し、初期化処理を実装する。
    - 参照: [`docs/data.md`](docs/data.md:9)
    - テストリスト:
        - [ ] 全てのテーブルが正しく作成されること
        - [ ] 各テーブルにデータが挿入・取得できること
        - [ ] インデックスが正しく適用されていること
        - [ ] データベースファイルが指定パスに作成されること
    - 進捗: 未着手。

- [ ] **プレイヤー管理ロジックの実装とUI連携（Backend & IPC）**
    - 内容: プレイヤーの新規登録、一覧取得、選択ロジックをRustで実装し、FrontendからのIPC呼び出しに対応させる。FrontendのダミーデータをBackendからのデータに置き換える。
    - 参照: [`docs/data.md`](docs/data.md:39), [`docs/components.md`](docs/components.md:38)
    - テストリスト:
        - [ ] FrontendからBackend経由でプレイヤーの登録・取得・選択ができること
        - [ ] 登録されたプレイヤー情報が永続化されること
        - [ ] プレイヤー名の重複チェックが機能すること
    - 進捗: 未着手。

- [ ] **ゲームロジック（01/Cricket）のコア実装（Backend）**
    - 内容: 01ゲームおよびCricketゲームのスコア計算、ラウンド進行管理の基本ロジックをRustで実装する。スタッツ・レーティング計算は含めない。
    - 参照: [`docs/spec.md`](docs/spec.md:104), [`docs/components.md`](docs/components.md:49)
    - テストリスト:
        - [ ] 01ゲームのスコア計算が正しく行われること（バースト、チェックアウト含む）
        - [ ] Cricketゲームのスコア計算とマーク管理が正しく行われること
        - [ ] ラウンド進行が正しく管理されること
    - 進捗: 未着手。

- [ ] **投擲結果の永続化とUI連携（Backend & IPC）**
    - 内容: `throws` テーブルへの投擲結果の保存、`zero_one_round_states` および `cricket_marks`/`cricket_scores` テーブルへのラウンド状態の保存ロジックをRustで実装し、FrontendからのIPC呼び出しに対応させる。ゲーム画面のスコア表示をBackendからのデータで更新する。
    - 参照: [`docs/data.md`](docs/data.md:77), [`docs/components.md`](docs/components.md:50)
    - テストリスト:
        - [ ] Frontendからの入力で投擲結果がデータベースに正しく保存されること
        - [ ] 各ラウンド終了時のゲーム状態が正しく保存されること
        - [ ] UIのスコア表示がBackendからのデータで正しく更新されること
        - [ ] UNDO操作がデータベースに反映されること
    - 進捗: 未着手。

### Phase 3: カメラ連携とリアルタイム観戦機能

- [ ] **カメラデバイスの列挙と選択（Backend & Frontend）**
    - 内容: システムに接続されているカメラデバイスを列挙し、設定画面でユーザーが選択できるようにする。
    - 参照: [`docs/other.md`](docs/other.md:25)
    - テストリスト:
        - [ ] 接続されているカメラデバイスが正しく列挙されること
        - [ ] 設定画面でカメラを選択し、その設定が保存されること
    - 進捗: 未着手。

- [ ] **カメラ連携機能（録画）の実装（Backend）**
    - 内容: 姿勢カメラとボードカメラからのリアルタイム録画、動画ファイルの指定パスへの保存ロジックをRustで実装する。
    - 参照: [`docs/spec.md`](docs/spec.md:121), [`docs/components.md`](docs/components.md:48), [`docs/other.md`](docs/other.md:25)
    - テストリスト:
        - [ ] 2つのカメラから同時に動画が録画できること
        - [ ] 録画された動画が指定パスに命名規則に従って保存されること
        - [ ] ディスク空き容量不足時に録画が停止し、エラーが通知されること
    - 進捗: 未着手。

- [ ] **ラウンド終了・動画再生画面の実装（Frontend & Backend連携）**
    - 内容: ラウンド終了後、動画再生画面に遷移し、録画された動画を再生するUIを実装する。再生コントロール（一時停止、スロー再生）も実装する。動画ファイルのパスはBackendから取得する。
    - 参照: [`docs/uiux.md`](docs/uiux.md:96), [`docs/spec.md`](docs/spec.md:124)
    - テストリスト:
        - [ ] ラウンド終了後、動画再生画面に遷移し、動画が再生できること
        - [ ] 再生コントロールが機能すること（通常再生、スロー再生、一時停止）
        - [ ] 動画のシークバーが正しく動作すること
    - 進捗: 未着手。

- [ ] **リアルタイム観戦機能（RPCサーバー）の実装（Backend）**
    - 内容: CoreプロセスでのRPCサーバー機能の提供、閲覧用ブラウザからの接続受付、ゲーム状態のリアルタイムブロードキャストロジックをRustで実装する。
    - 参照: [`docs/components.md`](docs/components.md:51), [`docs/spec.md`](docs/spec.md:145)
    - テストリスト:
        - [ ] RPCサーバーが指定ポートで起動すること
        - [ ] 閲覧用ブラウザからRPCサーバーに接続できること
        - [ ] ゲーム状態の更新がリアルタイムで閲覧用ブラウザに通知されること
        - [ ] 閲覧ブラウザの接続切断時に再接続が試みられること
    - 進捗: 未着手。

### Phase 4: データ分析・統計機能とエラーハンドリング・ログ

- [ ] **スタッツ・レーティング計算ロジックの実装（Backend）**
    - 内容: PPD/MPR、総合レーティング、01/Cricket独立レーティングの計算ロジックをRustで実装する。
    - 参照: [`docs/spec.md`](docs/spec.md:104)
    - テストリスト:
        - [ ] PPD/MPRが正しく計算されること
        - [ ] 総合レーティングがDartsLiveテーブルに基づき正しく算出されること
        - [ ] 01/Cricket独立レーティングが正しく算出されること
    - 進捗: 未着手。

- [ ] **統計データ画面の実装（Frontend & Backend連携）**
    - 内容: 過去のゲーム履歴一覧表示、レーティング・PPD/MPRの推移グラフ表示、フィルタリング機能のUIを実装し、Backendからデータを取得して表示する。
    - 参照: [`docs/uiux.md`](docs/uiux.md:135), [`docs/spec.md`](docs/spec.md:133)
    - テストリスト:
        - [ ] 過去のゲーム履歴が一覧で表示されること
        - [ ] レーティングやスタッツの推移グラフが正しく表示されること
        - [ ] 日付やゲーム種別でフィルタリングできること
        - [ ] 期間（当日、直近10ゲーム、全期間）切り替えが機能すること
    - 進捗: 未着手。

- [ ] **エラーハンドリングの実装（Frontend & Backend）**
    - 内容: `docs/other.md` に基づくエラーハンドリング（カメラ認識、ディスク容量、DB破損、RPCポート使用済みなど）をFrontendとBackendの両方で実装する。共通エラーレスポンス形式に従う。
    - 参照: [`docs/other.md`](docs/other.md:6), [`docs/data.md`](docs/data.md:130)
    - テストリスト:
        - [ ] カメラが認識されない場合にモーダルダイアログが表示され、設定画面に遷移できること
        - [ ] カメラが切断された場合にトースト通知が表示されること
        - [ ] データベースファイル破損時にバックアップからの復元確認ダイアログが表示されること
        - [ ] RPCポート使用済み時にモーダルダイアログが表示され、設定画面に遷移できること
    - 進捗: 未着手。

- [ ] **ログ機能の実装（Backend）**
    - 内容: tauri-plugin-logを使用したログ出力、ログローテーション、ログのエクスポート機能の実装。
    - 参照: [`docs/other.md`](docs/other.md:34)
    - テストリスト:
        - [ ] ログが指定パスに正しく出力され、ローテーションされること
        - [ ] ログのフォーマットが仕様通りであること
        - [ ] 診断情報エクスポートボタンでログと設定ファイルがZIP化されること
    - 進捗: 未着手。

- [ ] **設定管理機能の実装（Frontend & Backend）**
    - 内容: `docs/other.md` の設定項目に基づき、設定画面のUIと、設定の保存・読み込みロジックを実装する。
    - 参照: [`docs/other.md`](docs/other.md:19)
    - テストリスト:
        - [ ] 各設定項目が正しく保存・読み込みできること
        - [ ] 設定変更がアプリケーションの動作に反映されること
        - [ ] デフォルト値が正しく適用されること
    - 進捗: 未着手。

### Phase 5: 将来的なサーバー分離フェーズへの準備

- [ ] **オフラインファースト設計の検討**
    - 内容: 将来的なサーバー分離を見据え、ローカルキャッシュの利用やデータ同期の基本的な設計を検討する。
    - 参照: [`docs/spec.md`](docs/spec.md:58)
    - テストリスト:
        - (設計フェーズのためテスト項目なし)
    - 進捗: 未着手。

- [ ] **認証・認可に関する考慮事項の整理**
    - 内容: 将来的なユーザー認証・認可の仕組みについて、OAuth2やJWTなどの標準プロトコルを考慮し、設計の方向性を整理する。
    - 参照: [`docs/spec.md`](docs/spec.md:80)
    - テストリスト:
        - (設計フェーズのためテスト項目なし)
    - 進捗: 未着手。
